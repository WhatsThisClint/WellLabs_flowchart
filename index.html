<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Flow Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #ffffff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        #flowchart {
            width: 100%;
            height: 100%;
            background: white;
        }

        .mermaid {
            width: 100%;
            height: 100%;
        }

        /* Simple hover effect */
        #flowchart svg g.node rect {
            transition: transform 0.2s ease;
        }

        #flowchart svg g.node:hover rect {
            transform: scale(1.02);
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mouse-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            font-size: 14px;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: #666;
            z-index: 1000;
            text-align: left;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: background 0.2s ease;
        }

        .btn:hover {
            background: #2563eb;
        }

        /* Keep the nice greeting card style */
        .greeting {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-size: 20px;
            color: #1f2937;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            animation: slideIn 0.5s ease forwards;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Inter', sans-serif;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .greeting span {
            color: #3b82f6;
            font-weight: 600;
        }

        .greeting img {
            width: 28px;
            height: 28px;
            object-fit: contain;
        }

        /* Style for bullet points in mermaid nodes */
        .node foreignObject div {
            text-align: left !important;
            padding-left: 10px;
        }

        /* Ensure bullet points are left-aligned */
        .node text {
            text-align: left !important;
        }

        /* Override any center alignment for detail nodes */
        .detail text, .critique text {
            text-align: left !important;
        }

        /* Add some padding for bullet points in nodes */
        .node foreignObject {
            overflow: visible;
            padding-left: 5px;
        }
    </style>
</head>
<body>
    <div class="greeting"></div>

    <div id="container">
        <div id="flowchart">
            <pre class="mermaid">
                %%{
                    init: {
                        'theme': 'base',
                        'themeVariables': {
                            'primaryColor': '#e1f5fe',
                            'primaryBorderColor': '#01579b',
                            'lineColor': '#333',
                            'fontSize': '16px'
                        },
                        'flowchart': {
                            'htmlLabels': true,
                            'curve': 'basis'
                        }
                    }
                }%%
                flowchart TD
                    %% Core Research Structure
                    A[Research Paradox] --> B[Methodology]
                    B --> C[Analysis Framework]
                    C --> D[Alternative Metrics]
                    D --> E[Implications]

                    %% Research Paradox Breakdown
                    subgraph A_main[Conflicting Evidence]
                        A1[Official Reports: Recovery] -->|Conflicts with| A2[Ground Reality]
                        A1_detail["• GRACE data showing increase
                        • Rising water levels in monitoring wells
                        • Political intervention claims"]
                        A2_detail["• Increasing well failures
                        • Decreasing shallow well irrigation
                        • Rising farmer distress
                        • More newspaper reports of depletion"]
                        A1 --- A1_detail
                        A2 --- A2_detail
                    end
                    A --> A_main

                    %% Methodology
                    subgraph B_main[Data Collection & Analysis Issues]
                        B1[Traditional Methods] -->|Lead to| B2[Systematic Bias]
                        B1_detail["• Well monitoring data
                        • GRACE satellite observations
                        • Groundwater level trends"]
                        B2_detail["• Survivor bias in data selection
                        • Missing data exclusion
                        • Spatial averaging issues"]
                        B1 --- B1_detail
                        B2 --- B2_detail
                    end
                    B --> B_main

                    %% Analysis Framework
                    subgraph C_main[Evidence Analysis]
                        C1[Hard-Rock Aquifer Context] --> C2[Data Correlations]
                        C2 --> C3[Pattern Recognition]
                        C1_detail["• Low storage capacity
                        • High spatial heterogeneity
                        • Large seasonal fluctuations"]
                        C2_detail["• Missing data vs climate stress
                        • Well depth vs water availability
                        • Irrigation patterns vs well status"]
                        C3_detail["• Defunct well patterns
                        • Dry well distributions
                        • Regional stress indicators"]
                        C1 --- C1_detail
                        C2 --- C2_detail
                        C3 --- C3_detail
                    end
                    C --> C_main

                    %% Alternative Metrics
                    subgraph D_main[New Assessment Approach]
                        D1[Proposed Metrics] --> D2[Implementation Challenges]
                        D2 --> D3[Validation Methods]
                        D1_detail["• Defunct wells percentage
                        • Dry wells percentage
                        • Short-term reliability measures"]
                        D2_detail["• Data quality variability
                        • Measurement inconsistencies
                        • Time scale differences"]
                        D3_detail["• Correlation with ground reports
                        • Agricultural census alignment
                        • Local knowledge integration"]
                        D1 --- D1_detail
                        D2 --- D2_detail
                        D3 --- D3_detail
                    end
                    D --> D_main

                    %% Implications
                    subgraph E_main[Impact & Applications]
                        E1[Policy Recommendations] --> E2[Global Relevance]
                        E2 --> E3[Future Directions]
                        E1_detail["• Improved data collection
                        • Context-specific interventions
                        • Resource allocation strategy"]
                        E2_detail["• Applicable to similar aquifers
                        • Methodology adaptation needs
                        • Regional consideration requirements"]
                        E3_detail["• Enhanced monitoring systems
                        • Integration of local knowledge
                        • Balance of statistical & practical needs"]
                        E1 --- E1_detail
                        E2 --- E2_detail
                        E3 --- E3_detail
                    end
                    E --> E_main

                    %% Critical Considerations
                    Stat_Crit["STATISTICAL ANALYSIS:
                    • Mann-Kendall (MK) test is a statistical standard for determining trend reliability
                    • Sen's slope should only be used if MK denotes a trend
                    • Cannot compromise statistical standards for inclusivity always
                    • Time series completeness requirements"]

                    Data_Crit["DATA QUALITY & COMPLEXITY:
                    • Rainfall-recharge complexity often simplified
                    • Different infiltration patterns for same rainfall intensity
                    • Hard-rock aquifers as isolated systems
                    • Wells 40-60 ft apart can behave independently
                    • Vesicular and fractured layers have different properties"]

                    Method_Crit["METHODOLOGICAL CONSIDERATIONS:
                    • Timing-related variations:
                      - Well measurement timing differences
                      - Seasonal measurement variations
                      - Different measurement intervals
                    • Analysis challenges:
                      - Starting time bias in analysis
                      - Well density representation issues
                    • Data collection issues:
                      - Reasons for stopped measurements vary
                      - Time scale differences in well establishment"]

                    Context_Crit["GLOBAL APPLICATION:
                    • Survivor bias validity varies by context (justified in South India)
                    • Balance needed between statistical accuracy and inference
                    • Region-specific methodology requirements
                    • Risk of introducing new biases with alternative metrics
                    • Need for aquifer-specific understanding
                    • Local knowledge crucial for validation"]

                    B_main -.->|Critical Note| Stat_Crit
                    C_main -.->|Critical Note| Data_Crit
                    D_main -.->|Critical Note| Method_Crit
                    E_main -.->|Critical Note| Context_Crit

                    %% Styling
                    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px
                    classDef main fill:#e1f5fe,stroke:#01579b,stroke-width:2px
                    classDef detail fill:#f3f3f3,stroke:#666,stroke-width:1px
                    classDef critique fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
                    
                    class A,B,C,D,E main
                    class A1_detail,A2_detail,B1_detail,B2_detail,C1_detail,C2_detail,C3_detail,D1_detail,D2_detail,D3_detail,E1_detail,E2_detail,E3_detail detail
                    class Stat_Crit,Data_Crit,Method_Crit,Context_Crit critique
            </pre>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="zoomIn()">Zoom In</button>
        <button class="btn" onclick="zoomOut()">Zoom Out</button>
        <button class="btn" onclick="resetZoom()">Reset</button>
    </div>

    <div class="mouse-controls" style="text-align: left;">
        🖱️ Mouse Controls:<br>
        &nbsp;&nbsp;• Scroll to zoom in/out<br>
        &nbsp;&nbsp;• Click & drag to pan<br>
        &nbsp;&nbsp;• Hover over nodes to enlarge<br>
        <br>
        ⌨️ Keyboard Controls:<br>
        &nbsp;&nbsp;• Arrow keys to pan<br>
        &nbsp;&nbsp;• + / - to zoom
    </div>

    <script>
        let panZoom;

        // Add greeting function
        function showGreeting() {
            const hour = new Date().getHours();
            let greeting;
            let emoji;

            if (hour >= 5 && hour < 12) {
                greeting = "Good Morning";
                emoji = "🌅";
            } else if (hour >= 12 && hour < 17) {
                greeting = "Good Afternoon";
                emoji = "☀️";
            } else if (hour >= 17 && hour < 22) {
                greeting = "Good Evening";
                emoji = "🌆";
            } else {
                greeting = "Hello";
                emoji = "👋";
            }

            const greetingDiv = document.querySelector('.greeting');
            greetingDiv.innerHTML = `${emoji} <img src="./water-well.png" alt="Well Labs" /> <span>${greeting}</span>, Welcome to my Research Flow Analysis!`;

            // Remove the greeting after 5 seconds
            setTimeout(() => {
                greetingDiv.style.opacity = '0';
                greetingDiv.style.transform = 'translateY(-20px)';
                setTimeout(() => greetingDiv.remove(), 500);
            }, 5000);
        }

        function initializePanZoom() {
            if (panZoom) {
                panZoom.destroy();
            }

            const svg = document.querySelector("#flowchart svg");
            if (svg) {
                panZoom = svgPanZoom(svg, {
                    zoomEnabled: true,
                    controlIconsEnabled: false,
                    fit: true,
                    center: true,
                    minZoom: 0.1,
                    maxZoom: 10
                });
            }
        }

        function zoomIn() {
            if (panZoom) {
                panZoom.zoomIn();
            }
        }

        function zoomOut() {
            if (panZoom) {
                panZoom.zoomOut();
            }
        }

        function resetZoom() {
            if (panZoom) {
                panZoom.resetZoom();
                panZoom.center();
            }
        }

        // Add keyboard controls
        let isKeyPressed = false;
        let currentAnimation;

        function smoothPan(x, y) {
            if (currentAnimation) {
                cancelAnimationFrame(currentAnimation);
            }

            const STEPS = 20; // Number of steps for smooth transition
            const INTERVAL = 1000 / 60; // 60 FPS
            let step = 0;

            function animate() {
                if (step < STEPS) {
                    panZoom.panBy({
                        x: x / STEPS,
                        y: y / STEPS
                    });
                    step++;
                    currentAnimation = requestAnimationFrame(animate);
                }
            }

            animate();
        }

        document.addEventListener('keydown', (e) => {
            if (!panZoom || isKeyPressed) return;
            
            const STEP = 100; // Total distance to pan
            isKeyPressed = true;
            
            switch(e.key) {
                case 'ArrowLeft':
                    smoothPan(STEP, 0);
                    break;
                case 'ArrowRight':
                    smoothPan(-STEP, 0);
                    break;
                case 'ArrowUp':
                    smoothPan(0, STEP);
                    break;
                case 'ArrowDown':
                    smoothPan(0, -STEP);
                    break;
                case '+':
                case '=':
                    panZoom.zoomIn();
                    break;
                case '-':
                case '_':
                    panZoom.zoomOut();
                    break;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.key)) {
                isKeyPressed = false;
            }
        });

        // Initialize Mermaid and setup
        mermaid.initialize({ 
            startOnLoad: true,
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: false
            }
        });

        mermaid.init(undefined, ".mermaid").then(() => {
            initializePanZoom();
            showGreeting(); // Show greeting after flowchart is initialized
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            initializePanZoom();
        });
    </script>
</body>
</html>